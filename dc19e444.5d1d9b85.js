(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{107:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return l})),t.d(n,"metadata",(function(){return i})),t.d(n,"toc",(function(){return c})),t.d(n,"default",(function(){return s}));var r=t(3),a=t(7),o=(t(0),t(114)),l={id:"flavor_helpers",title:"Flavor_helpers",generated:"@generated"},i={unversionedId:"api/flavor_helpers",id:"api/flavor_helpers",isDocsHomePage:!1,title:"Flavor_helpers",description:"A flavor is a string identifier that controls build configurations.",source:"@site/docs/api/gen-flavor_helpers.md",slug:"/api/flavor_helpers",permalink:"/antlir/docs/api/flavor_helpers",editUrl:"https://github.com/facebookincubator/antlir/edit/master/website/docs/api/gen-flavor_helpers.md",version:"current",sidebar:"docs",previous:{title:"Shape",permalink:"/antlir/docs/api/shape"},next:{title:".bzl and TARGETS",permalink:"/antlir/docs/contributing/coding-conventions/bzl-and-targets"}},c=[{value:"Using Flavors",id:"using-flavors",children:[]},{value:"In progress",id:"in-progress",children:[]},{value:"<code>get_build_appliance</code>",id:"get_build_appliance",children:[]},{value:"<code>get_flavor_config</code>",id:"get_flavor_config",children:[]},{value:"<code>get_rpm_installer</code>",id:"get_rpm_installer",children:[]},{value:"<code>get_rpm_installers_supported</code>",id:"get_rpm_installers_supported",children:[]}],p={toc:c};function s(e){var n=e.components,t=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},p,t,{components:n,mdxType:"MDXLayout"}),Object(o.b)("p",null,"A flavor is a string identifier that controls build configurations.\nOptions contained in a flavor can include ",Object(o.b)("inlineCode",{parentName:"p"},"build_appliance")," as well\nas ",Object(o.b)("inlineCode",{parentName:"p"},"rpm_installer"),"."),Object(o.b)("p",null,"This allows us to specify compability between\ndifferent images. For example, we can make sure that ",Object(o.b)("inlineCode",{parentName:"p"},"centos7")," images\ndo not depend on ",Object(o.b)("inlineCode",{parentName:"p"},"centos8")," images, which is a breaking version."),Object(o.b)("p",null,"It also allows to reuse common build opts throughout the codebase\nwith less duplication."),Object(o.b)("p",null,"Flavors are strings instead of functions because a flavor must have\na stable identity as the source tree evolves. We must be able to\ncompare flavors between old revs and new. The container runtime must\nalso be able to rely on stable flavor IDs. Flavors names must\nfollow two critical rules:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),"- Never change a flavor name\n- Never reuse a flavor name\n")),Object(o.b)("h2",{id:"using-flavors"},"Using Flavors"),Object(o.b)("p",null,"To create a flavor add a mapping to ",Object(o.b)("inlineCode",{parentName:"p"},"antlir/bzl/oss_shim_impl.bzl")),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),'shim = struct(\n    do_not_use_repo_cfg = {\n        "flavor_to_config": {\n            "your_flavor_here": {\n                "build_appliance": "//path/to/your/build/appliance",\n                "rpm_installer": "your_rpm_installer",\n            },\n        },\n    },\n\n)\n')),Object(o.b)("p",null,"Then, you can pass the flavor to images. You can also override the\ndefault value in the flavor with custom ones."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),'image.layer(\n    flavor = "your_flavor_here",\n    flavor_config_overrides = image.opts(\n        build_appliance = "//your/override/build/appliance",\n        ...\n    )\n)\n')),Object(o.b)("h2",{id:"in-progress"},"In progress"),Object(o.b)("p",null,"The flavor of an image is written to the ",Object(o.b)("inlineCode",{parentName:"p"},"/.meta"),"\ndirectory of the image. This allows you to check the compatibility\nof sendstreams, as a sendstream could have been built on\nan older revision with a different build appliance than what\nis in the repo currently."),Object(o.b)("h1",{id:"api"},"API"),Object(o.b)("h2",{id:"get_build_appliance"},Object(o.b)("inlineCode",{parentName:"h2"},"get_build_appliance")),Object(o.b)("p",null,"Prototype: ",Object(o.b)("inlineCode",{parentName:"p"},"get_build_appliance(flavor)")),Object(o.b)("p",null,"No docstring available."),Object(o.b)("h2",{id:"get_flavor_config"},Object(o.b)("inlineCode",{parentName:"h2"},"get_flavor_config")),Object(o.b)("p",null,"Prototype: ",Object(o.b)("inlineCode",{parentName:"p"},"get_flavor_config(flavor, flavor_config_override)")),Object(o.b)("p",null,"Arguments"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"flavor"),": The name of the flavor to fetch the config."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"flavor_config_override"),": An opts that contains any overrides for\nthe default config of a flavor that will be applied.")),Object(o.b)("p",null,"Example usage:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),'load("//antlir/bzl:flavor_helpers.bzl", "flavor_helpers")\n\nflavor_config = flavor_helpers.get_flavor_config(flavor, flavor_config_override)\nbuild_appliance = flavor_config["build_appliance"]\n')),Object(o.b)("h2",{id:"get_rpm_installer"},Object(o.b)("inlineCode",{parentName:"h2"},"get_rpm_installer")),Object(o.b)("p",null,"Prototype: ",Object(o.b)("inlineCode",{parentName:"p"},"get_rpm_installer(flavor)")),Object(o.b)("p",null,"No docstring available."),Object(o.b)("h2",{id:"get_rpm_installers_supported"},Object(o.b)("inlineCode",{parentName:"h2"},"get_rpm_installers_supported")),Object(o.b)("p",null,"Prototype: ",Object(o.b)("inlineCode",{parentName:"p"},"get_rpm_installers_supported()")),Object(o.b)("p",null,"No docstring available."))}s.isMDXComponent=!0},114:function(e,n,t){"use strict";t.d(n,"a",(function(){return b})),t.d(n,"b",(function(){return f}));var r=t(0),a=t.n(r);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var p=a.a.createContext({}),s=function(e){var n=a.a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},b=function(e){var n=s(e.components);return a.a.createElement(p.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.a.createElement(a.a.Fragment,{},n)}},d=a.a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),b=s(t),d=r,f=b["".concat(l,".").concat(d)]||b[d]||u[d]||o;return t?a.a.createElement(f,i(i({ref:n},p),{},{components:t})):a.a.createElement(f,i({ref:n},p))}));function f(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,l=new Array(o);l[0]=d;var i={};for(var c in n)hasOwnProperty.call(n,c)&&(i[c]=n[c]);i.originalType=e,i.mdxType="string"==typeof e?e:r,l[1]=i;for(var p=2;p<o;p++)l[p]=t[p];return a.a.createElement.apply(null,l)}return a.a.createElement.apply(null,t)}d.displayName="MDXCreateElement"}}]);